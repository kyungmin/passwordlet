(function(e,a,g,h,f,c,b,d){if(!(f=e.jQuery)||g>f.fn.jquery||h(f)){c=a.createElement("script");c.type="text/javascript";c.src="https://ajax.googleapis.com/ajax/libs/jquery/"+g+"/jquery.min.js";c.onload=c.onreadystatechange=function(){if(!b&&(!(d=this.readyState)||d=="loaded"||d=="complete")){h((f=e.jQuery).noConflict(1),b=1);f(c).remove()}};a.documentElement.childNodes[0].appendChild(c)}})(window,document,"1.3.2",function($,L){
  $.ajax({
    type: "GET",
    url: "http://localhost:3000/domains/login",
    data: { domain: location.hostname },
    success: function(data) {
      if (data == "nothing") {
        if ($(".passwordlet-frame").length == 0) {
          $('body').prepend("<iframe class='passwordlet-frame' style='width: 100%; height:200px; z-index:10000; border: 0;' src='http://localhost:3000/'></iframe>");
        }        
      } else {
        var cookies = JSON.parse(data);
        for(var cookie in cookies) {
              var cookieStr = "";
              cookieStr += cookies[cookie].name + "=" + cookies[cookie].value + "; ";
              cookieStr += "expires=" + cookies[cookie].expires + "; ";
              cookieStr += "domain=" + cookies[cookie].domain + "; ";
              cookieStr += "path=" + cookies[cookie].path + ";";
              document.cookie = cookieStr;
        }
        window.location.reload();
      }
    }, error: function(data) {
        if ($(".passwordlet-frame").length == 0) {
          $('body').prepend("<div class='passwordlet-frame login-bar'>Welcome to Passwordlet</div>");
        }
    }
  });
});